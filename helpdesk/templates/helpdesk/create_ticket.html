{% extends "helpdesk/staff_base.html" %}{% load i18n bootstrap %}
{% load static from staticfiles %}

{% block helpdesk_title %}{% trans "Create Ticket" %}{% endblock %}

{% block extra_css %}
<link href="{% static 'helpdesk/css/bootstrap-datetimepicker.min.css' %}" rel="stylesheet">
{% endblock extra_css %}

{% block breadcrumb_items %}
<li><a href="{% url 'helpdesk:ticket-list' %}">Ticket List</a></li>
<li>New Ticket</li>
{% endblock %}

{% block content %}
<h2 class="page-title">{% trans 'Submit a Ticket' %}</h2>
<div class="row">
    <div class="col-md-12">
        <div class="panel panel-primary">
            <!-- /.panel-heading -->
            <div class="panel-heading">{% trans 'New Ticket' %}</div>
            <div class="panel-body">
                <p class="text-warning">{% trans "Unless otherwise stated, all fields are required." %} {% trans "Please provide as descriptive a title and description as possible." %}</p>
                <form method="post" enctype="multipart/form-data">
                    <fieldset class="col-md-8">
                        {% comment %}{{ form|bootstrap }}{% endcomment %}
                        {% for field in form %}
                            {% if field.is_hidden %}
                                {{ field }}
                            {% else %}
                                <div class="form-group">
                                    <dt><label for='id_{{ field.name }}'>{% trans field.label %}</label>{% if not field.field.required %} <span class='form_optional'>{% trans "(Optional)" %}</span>{% endif %}</dt>
                                    <dd>{{ field }}</dd>
                                    {% if field.errors %}<dd class='error'>{{ field.errors }}</dd>{% endif %}
                                    {% if field.help_text %}<dd class='form_help_text help-block'>{% trans field.help_text %}</dd>{% endif %}
                                </div>
                            {% endif %}
                        {% endfor %}

                        <div class='buttons form-group'>
                            <button type="submit" class="btn btn-primary btn-lg btn-block"><i class="fa fa-send"></i>&nbsp;{% trans "Submit Ticket" %}</button>
                        </div>
                    </fieldset>
                {% csrf_token %}</form>
                <!-- /.form -->
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'helpdesk/js/moment.min.js' %}"></script>
<script src="{% static 'helpdesk/js/bootstrap-datetimepicker.min.js' %}"></script>
<script type='text/javascript' language='javascript'>
// this function listens for changes on any file input, and
// emits the appropriate event to update the input's text.
// Needed to have properly styled file input buttons! (this really shouldn't be this hard...)
$(document).ready(function () {
    $( "#id_due_date" ).datetimepicker({
        format: 'YYYY-MM-DD',
        showTodayButton: true,
        useCurrent: false,
        showClear: true
    });
    $(':file').on('change', function () {
        var input = $(this),
            inputWidgetNum = $(this).attr('id').split("file")[1],
            numFiles = input.get(0).files ? input.get(0).files.length : 1,
            label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
        input.trigger('fileselect', [numFiles, label, inputWidgetNum]);
    });
});
</script>
{% endblock %}
